<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat Online • Usuário / ADM</title>
  <style>
    :root{
      --bg:#101418; --panel:#151a20; --card:#1b2129; --bubble-user:#2a2f36;
      --bubble-adm:#0e5f3b; --text:#e6eef7; --muted:#a7b0bb; --line:#242a32; --accent:#00e29f;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
    a.link{color:var(--muted); text-decoration:none} a.link:hover{text-decoration:underline}
    .login-card{max-width:420px; margin:10vh auto; padding:24px; background:var(--card); border:1px solid var(--line); border-radius:12px}
    .login-card h1{margin:0 0 12px} .login-card label{display:block; margin:12px 0 6px; color:var(--muted)}
    .login-card input,.login-card select{width:100%; padding:12px; border-radius:8px; border:1px solid var(--line); background:#0c1014; color:var(--text)}
    .login-card button{margin-top:16px; width:100%; padding:12px; border-radius:10px; border:0; background:var(--accent); color:#002417; font-weight:700; cursor:pointer}
    .hint{color:var(--muted); font-size:14px}
    .hidden{display:none!important}
    .chat-wrap{display:flex; flex-direction:column; height:100vh; max-width:920px; margin:0 auto}
    .chat-header{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 14px; border-bottom:1px solid var(--line); background:var(--panel); position:sticky; top:0; z-index:10}
    .chat-title{font-weight:700} .chat-subtitle{color:var(--muted); font-size:13px}
    .btn-link,.link{background:none; border:0; color:var(--muted); cursor:pointer}
    .messages{flex:1; overflow-y:auto; padding:16px; background:linear-gradient(#0c1116,#0b0e12)}
    .msg{max-width:70%; padding:10px 12px; margin:6px 0; border-radius:14px; position:relative; word-wrap:break-word; white-space:pre-wrap}
    .msg .time{display:block; margin-top:6px; font-size:11px; color:var(--muted); text-align:right; opacity:.8}
    .me{background:var(--bubble-user); border-top-left-radius:4px}
    .adm{background:var(--bubble-adm); border-top-right-radius:4px}
    .center{margin:10px auto; text-align:center; color:var(--muted); font-size:12px}
    .composer{border-top:1px solid var(--line); background:var(--panel); padding:10px}
    .composer form{display:flex; gap:10px; align-items:center}
    .composer input[type="text"]{flex:1; padding:12px; border-radius:8px; border:1px solid var(--line); background:#0c1014; color:var(--text)}
    .composer button{padding:0 18px; border-radius:999px; border:0; background:var(--accent); color:#002417; font-weight:800; cursor:pointer}
    .admin-layout{display:grid; grid-template-columns:320px 1fr; height:100vh}
    .sidebar{border-right:1px solid var(--line); background:var(--panel); display:flex; flex-direction:column}
    .brand{padding:14px 16px; font-weight:800; border-bottom:1px solid var(--line)}
    .search{padding:8px 10px; border-bottom:1px solid var(--line)}
    .search input{width:100%; padding:10px; border-radius:8px; border:1px solid var(--line); background:#0c1014; color:#e6eef7}
    .rooms{list-style:none; margin:0; padding:0; overflow-y:auto}
    .room{padding:12px 14px; border-bottom:1px solid var(--line); cursor:pointer; display:flex; gap:10px; align-items:center}
    .room:hover{background:#10161d}
    .room .title{font-weight:700} .room .sub{color:var(--muted); font-size:12px}
    .badge{background:var(--accent); color:#002417; font-weight:700; padding:0 8px; border-radius:999px; font-size:12px; margin-left:auto}
    .dot{display:inline-block; width:8px; height:8px; border-radius:50%; background:#666; margin-right:6px; vertical-align:middle}
    .dot.online{background:#1bd760}
    #view-user{display:block} #view-admin{display:none}
    .small{font-size:12px; opacity:.8}
  </style>

  <!-- XLSX para exportar relatório -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>
</head>
<body>

  <!-- =========== VIEW: USUÁRIO ============ -->
  <div id="view-user">
    <div id="app">
      <section class="login-card" id="loginCard">
        <h1>Entrar no Chat</h1>
        <form id="loginForm">
          <label>Nome</label>
          <input id="nomeInput" required placeholder="Ex.: Ana" />
          <label>Contato</label>
          <input id="contatoInput" required placeholder="Ex.: (11) 9... / email" />
          <label>Assunto</label>
          <input id="assuntoInput" required placeholder="Ex.: Dúvida sobre boleto" />
          <label>Categoria</label>
          <select id="categoriaSelect" required>
            <option value="suporte">Suporte TI</option>
            <option value="operacao">Status</option>
          </select>
          <button type="submit">Entrar</button>
        </form>
        <p class="hint">Seu chat abre com um atendente. O histórico fica salvo para relatório.</p>
        <p class="hint">Área do atendente? <a class="link" href="#/admin">Abrir painel</a></p>
      </section>

      <section class="chat-wrap hidden" id="chatWrap">
        <header class="chat-header">
          <div>
            <div class="chat-title" id="chatTitle"></div>
            <div class="chat-subtitle" id="chatSubtitle"></div>
          </div>
          <button class="btn-link" id="btnLeave">sair</button>
        </header>

        <main class="messages" id="messages"></main>

        <footer class="composer">
          <form id="msgForm">
            <input id="msgInput" type="text" placeholder="Digite uma mensagem…" autocomplete="off" disabled />
            <button type="submit" title="Enviar" disabled>➤</button>
          </form>
        </footer>
      </section>
    </div>

    <audio id="ding" preload="auto">
      <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
    </audio>
  </div>

  <!-- =========== VIEW: ADMIN ============ -->
  <div id="view-admin">
    <div class="admin-layout">
      <aside class="sidebar">
        <div class="brand">Painel de Atendentes</div>
        <div class="search">
          <form id="admLoginForm">
            <input id="admEmail" type="email" required placeholder="email do atendente" />
            <input id="admPass" type="password" required placeholder="senha" />
            <select id="admGroup">
              <option value="suporte">Suporte TI</option>
              <option value="operacao">Operação</option>
            </select>
            <button id="admLoginBtn" type="submit">Entrar ADM</button>
            <button id="admRegister" type="button">Cadastrar</button>
          </form>
          <div style="margin-top:8px; display:flex; gap:8px">
            <button id="btnAvailable" class="btn-link">marcar disponível</button>
            <button id="admLogout" class="btn-link">sair</button>
          </div>
          <input id="filterInput" placeholder="filtrar por nome/assunto…" style="margin-top:10px" />
        </div>
        <ul class="rooms" id="roomsList"></ul>
        <div style="padding:10px">
          <button id="btnReport">Exportar XLSX</button>
        </div>
      </aside>

      <section style="display:flex; flex-direction:column">
        <header class="chat-header">
          <div>
            <div class="chat-title" id="roomTitle">Selecione um chat</div>
            <div class="chat-subtitle"><span id="roomStatusDot" class="dot"></span><span id="roomStatusText">—</span></div>
          </div>
          <button id="btnCloseChat" class="btn-link" disabled>finalizar</button>
        </header>

        <main class="messages" id="adminMessages"></main>

        <footer class="composer">
          <form id="adminMsgForm">
            <input id="adminMsgInput" type="text" placeholder="Escreva uma resposta…" autocomplete="off" disabled />
            <button type="submit" title="Enviar" disabled>➤</button>
          </form>
        </footer>
      </section>
    </div>
  </div>

  <!-- ======= SCRIPTS ======= -->
  <script type="module" src="./app.js"></script>
  <script type="module" src="./admin.js"></script>
</body>
</html>
